(function e$$0(g,h,b){function e(a,f){if(!h[a]){if(!g[a]){var k="function"==typeof require&&require;if(!f&&k)return k(a,!0);if(d)return d(a,!0);k=Error("Cannot find module '"+a+"'");throw k.code="MODULE_NOT_FOUND",k;}k=h[a]={exports:{}};g[a][0].call(k.exports,function(b){var d=g[a][1][b];return e(d?d:b)},k,k.exports,e$$0,g,h,b)}return h[a].exports}for(var d="function"==typeof require&&require,a=0;a<b.length;a++)e(b[a]);return e})({1:[function(l,g,h){(function(){function b(){if(!g&&(g=!0,h)){for(var a=
0;a<h.length;a++)h[a].call(window,[]);h=[]}}function e(a){var c=window.onload;window.onload="function"!=typeof window.onload?a:function(){c&&c();a()}}function d(){if(!k){k=!0;document.addEventListener&&!f.opera&&document.addEventListener("DOMContentLoaded",b,!1);f.msie&&window==top&&function(){if(!g){try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}b()}}();f.opera&&document.addEventListener("DOMContentLoaded",function(){if(!g){for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].disabled){setTimeout(arguments.callee,
0);return}b()}},!1);if(f.safari){var a;(function(){if(!g)if("loaded"!=document.readyState&&"complete"!=document.readyState)setTimeout(arguments.callee,0);else{if(void 0===a){for(var c=document.getElementsByTagName("link"),e=0;e<c.length;e++)"stylesheet"==c[e].getAttribute("rel")&&a++;c=document.getElementsByTagName("style");a+=c.length}document.styleSheets.length!=a?setTimeout(arguments.callee,0):b()}})()}e(b)}}var a=window.DomReady={},c=navigator.userAgent.toLowerCase(),f={version:(c.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||
[])[1],safari:/webkit/.test(c),opera:/opera/.test(c),msie:/msie/.test(c)&&!/opera/.test(c),mozilla:/mozilla/.test(c)&&!/(compatible|webkit)/.test(c)},k=!1,g=!1,h=[];a.ready=function(a,c){d();g?a.call(window,[]):h.push(function(){return a.call(window,[])})};d()})()},{}],2:[function(l,g,h){l("./libs/domready");var b=l("./modules/parser");DomReady.ready(function(){(new b).init()})},{"./libs/domready":1,"./modules/parser":5}],3:[function(l,g,h){function b(){this._bookmarks=[];this._differentBookmarks=
{}}b.prototype.compare=function(e){this._differentBookmarks={};this._bookmarks=e||[];this._bookmarks.forEach(function(e,a){this._findDifference([],e,a,e)}.bind(this));return this._differentBookmarks};b.prototype._findDifference=function(e,b,a,c){for(var f in b)"links"===f?this._findDifferentLinks(e,b,a,c):"data"!==f&&this._findDifference(e.concat([f]),b[f],a,c)};b.prototype._findDifferentLinks=function(e,b,a,c){if(0<b.links.length){var f=[];this._bookmarks.forEach(function(c,g){g!==a&&(f=f.concat(this._findDifferentLinksForPath(e,
b,c)))}.bind(this));f.length&&this._addDifferentLinks(e,f,c)}};b.prototype._findDifferentLinksForPath=function(e,b,a){var c=[];e=this._getFolder(e,a);return c=e.isNew?b.links:this._findNewLinks(e.body,b)};b.prototype._getFolder=function(b,d){var a={body:d,isNew:!1};b.forEach(function(c){a.body[c]?a.body=a.body[c]:a.isNew=!0});return a};b.prototype._findNewLinks=function(b,d){var a=[];if(!b.links.length)return a;d.links.forEach(function(c){this._isNewLink(b,c.url)&&a.push(c)}.bind(this));return a};
b.prototype._isNewLink=function(b,d){var a=!0;b.links.forEach(function(b){b.url===d&&(a=!1)});return a};b.prototype._addDifferentFolder=function(b,d){var a=this._differentBookmarks;b.forEach(function(b){a[b]=a[b]||{links:[],data:{}};a=a[b]});a.data=d};b.prototype._addDifferentLinks=function(b,d,a){var c=this._differentBookmarks,f=a;b.forEach(function(a){c[a]=c[a]||{links:[],data:this._cloneData(f[a].data)};c=c[a];f=f[a]}.bind(this));c.links=c.links.concat(d)};b.prototype._cloneData=function(b){var d=
{},a;for(a in b)d[a]=b[a];return d};g.exports=b},{}],4:[function(l,g,h){function b(){this.CONST={TAB_SIZE:4};this._string=[]}b.prototype.parse=function(b){b=b||{};this._resetOutString();this._jsonToString("",b.json,0);return b.returnArray?this._string:this.toText(this._string)};b.prototype.toText=function(b){b=b||[];return b.length?b.join("\n"):""};b.prototype._resetOutString=function(){this._string=[]};b.prototype._jsonToString=function(b,d,a){if(d){var c=this._calcOffset(a),f=c+this._calcOffset(1);
b&&(this._addTitleFromJson(b,c,d.data),a++);this._addLinksFromJson(f,d.links);this._addNextLevelFromJson(d,a);this._closeTitleFromJson(b,c)}};b.prototype._calcOffset=function(b){return Array((+b||0)*this.CONST.TAB_SIZE+1).join(" ")};b.prototype._addTitleFromJson=function(b,d,a){var c="Bookmarks"===b;this._string.push(d+(c?"<H1>":"<DT><H3"+(a.added?' ADD_DATE="'+a.added+'"':"")+(a.modify?' LAST_MODIFIED="'+a.modify+'"':"")+(a.personal?' PERSONAL_TOOLBAR_FOLDER="'+a.personal+'"':"")+">")+b+(c?"</H1>":
"</H3>"));this._string.push(d+"<DL><p>")};b.prototype._addLinksFromJson=function(b,d){d&&d.forEach(function(a){this._string.push(b+'<DT><A HREF="'+a.url+'" ADD_DATE="'+a.added+'" ICON="'+a.icon+'">'+a.title+"</A>")}.bind(this))};b.prototype._addNextLevelFromJson=function(b,d){if(b){var a,c;for(c in b)"links"!==c&&"data"!==c&&(a=this._jsonToString(c,b[c],d))&&this._string.push(a)}};b.prototype._closeTitleFromJson=function(b,d){b&&this._string.push(d+"</DL><p>")};g.exports=b},{}],5:[function(l,g,h){function b(){this.DEFAULTS=
{ID:"bookmarksFiles"};this._options={id:"",container:""};this._downloadLink=this._input=null;this._files=[];this._bookmarks=[];this._newFile={head:[],body:""};this._fileBody={};this._folderLevel={};this._breadcrumbs=[]}h=l("./compare");l=l("./json_to_string");var e=new h,d=new l;b.prototype.init=function(a){this._setOptions(a||{});this._attachInput()};b.prototype.onInputChange=function(){var a;this._hideDownloadLink();this._bookmarks=[];this._files=this._input.files;this._newFile.head=[];this._newFile.body=
"";for(var b=0,d=this._files.length;b<d;b++)a=new FileReader,a.addEventListener("load",this._readFile.bind(this),!1),a.readAsText(this._files[b])};b.prototype._setOptions=function(a){this._options={id:a.id||"",container:a.container||""}};b.prototype._attachInput=function(){this._input=this._findInput();this._input||(this._input=this._createInput());this._input.addEventListener("change",this.onInputChange.bind(this),!1)};b.prototype._findInput=function(){var a=null;this._options.id&&(a=document.getElementById(this._options.id));
!a||"input"===a.tagName.toLowerCase()&&"file"===a.type||(a=null);return a};b.prototype._createInput=function(){var a=document.createElement("input");a.id=this._options.id||this.DEFAULTS.ID;a.type="file";a.setAttribute("multiple","");document.body.appendChild(a);return a};b.prototype._readFile=function(a){a=a.target.result.split("\n");var b=this._parseLine.bind(this);this._breadcrumbs=[];this._folderLevel=this._fileBody={};a.forEach(b);this._bookmarks.push(this._fileBody);this._compareAfterFinish()};
b.prototype._parseLine=function(a){a=a.trim();0===a.indexOf("<DT><H3")||0===a.indexOf("<H1")?this._addTitle(a):0===a.indexOf("<DL>")?this._addFolder(a):0===a.indexOf("<DT><A")?this._addLink(a):0===a.indexOf("</DL>")?this._closeFolder():this._addToHead(a)};b.prototype._addToHead=function(a){1===this._bookmarks.length&&this._newFile.head.push(a)};b.prototype._addTitle=function(a){var b=a.match(/>([^<^>]+)<\//),d=a.match(/ADD_DATE="([^"]*)"/),e=a.match(/LAST_MODIFIED="([^"]*)"/);a=a.match(/PERSONAL_TOOLBAR_FOLDER="([^"]*)"/);
this._breadcrumbs.push({title:b?b[1]:"",added:d?d[1]:"",modify:e?e[1]:"",personal:a?a[1]:""})};b.prototype._addFolder=function(a){this._folderLevel=this._fileBody;this._breadcrumbs.forEach(function(a){this._folderLevel[a.title]=this._folderLevel[a.title]||{links:[],data:{added:a.added,modify:a.modify,personal:a.personal}};this._folderLevel=this._folderLevel[a.title]}.bind(this))};b.prototype._addLink=function(a){var b=a.match(/>([^<^>]+)<\//),d=a.match(/HREF="([^"]*)"/),e=a.match(/ADD_DATE="([^"]*)"/);
a=a.match(/ICON="([^"]*)"/);this._folderLevel.links.push({title:b?b[1]:"",url:d?d[1]:"",added:e?e[1]:"",icon:a?a[1]:""})};b.prototype._closeFolder=function(){this._breadcrumbs.pop()};b.prototype._compareAfterFinish=function(){if(this._bookmarks.length===this._files.length){var a=e.compare(this._bookmarks);this._newFile.body=d.parse({json:a});this._newFile.body?this._downloadFile():alert("Not found different bookmarks");this._input.value=""}};b.prototype._arrayToString=function(a){return a.join("\n")};
b.prototype._downloadFile=function(){this._updateInput();this._showDownloadLink()};b.prototype._updateInput=function(){this._createDownloadLink();this._textToUrl()};b.prototype._textToUrl=function(){var a=new Blob([d.toText(this._newFile.head)+this._newFile.body]),a=URL.createObjectURL(a);this._downloadLink.href=a};b.prototype._createDownloadLink=function(){this._downloadLink||(this._downloadLink=document.createElement("a"),this._downloadLink.textContent="download",this._downloadLink.download="new_bookmarks.html",
document.body.appendChild(this._downloadLink))};b.prototype._showDownloadLink=function(){this._downloadLink&&this._downloadLink.classList.remove("hidden")};b.prototype._hideDownloadLink=function(){this._downloadLink&&this._downloadLink.classList.add("hidden")};g.exports=b},{"./compare":3,"./json_to_string":4}]},{},[2]);
