(function e$$0(e,g,b){function k(a,f){if(!g[a]){if(!e[a]){var h="function"==typeof require&&require;if(!f&&h)return h(a,!0);if(c)return c(a,!0);h=Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h;}h=g[a]={exports:{}};e[a][0].call(h.exports,function(b){var c=e[a][1][b];return k(c?c:b)},h,h.exports,e$$0,e,g,b)}return g[a].exports}for(var c="function"==typeof require&&require,a=0;a<b.length;a++)k(b[a]);return k})({1:[function(l,e,g){(function(){function b(){if(!e&&(e=!0,g)){for(var a=
0;a<g.length;a++)g[a].call(window,[]);g=[]}}function k(a){var b=window.onload;window.onload="function"!=typeof window.onload?a:function(){b&&b();a()}}function c(){if(!h){h=!0;document.addEventListener&&!f.opera&&document.addEventListener("DOMContentLoaded",b,!1);f.msie&&window==top&&function(){if(!e){try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}b()}}();f.opera&&document.addEventListener("DOMContentLoaded",function(){if(!e){for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].disabled){setTimeout(arguments.callee,
0);return}b()}},!1);if(f.safari){var a;(function(){if(!e)if("loaded"!=document.readyState&&"complete"!=document.readyState)setTimeout(arguments.callee,0);else{if(void 0===a){for(var d=document.getElementsByTagName("link"),k=0;k<d.length;k++)"stylesheet"==d[k].getAttribute("rel")&&a++;d=document.getElementsByTagName("style");a+=d.length}document.styleSheets.length!=a?setTimeout(arguments.callee,0):b()}})()}k(b)}}var a=window.DomReady={},d=navigator.userAgent.toLowerCase(),f={version:(d.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||
[])[1],safari:/webkit/.test(d),opera:/opera/.test(d),msie:/msie/.test(d)&&!/opera/.test(d),mozilla:/mozilla/.test(d)&&!/(compatible|webkit)/.test(d)},h=!1,e=!1,g=[];a.ready=function(a,d){c();e?a.call(window,[]):g.push(function(){return a.call(window,[])})};c()})()},{}],2:[function(l,e,g){l("./libs/domready");var b=l("./modules/parser");DomReady.ready(function(){(new b).init()})},{"./libs/domready":1,"./modules/parser":5}],3:[function(l,e,g){function b(){this._bookmarks=[];this._differentBookmarks=
{}}b.prototype.compare=function(b){this._differentBookmarks={};this._bookmarks=b;this._bookmarks.forEach(function(b,a){this._findDifference([],b,a,b)}.bind(this));return this._differentBookmarks};b.prototype._findDifference=function(b,c,a,d){for(var f in c)"links"===f?this._findDifferentLinks(b,c,a,d):"data"!==f&&this._findDifference(b.concat([f]),c[f],a,d)};b.prototype._findDifferentLinks=function(b,c,a,d){if(0<c.links.length){var f=[];this._bookmarks.forEach(function(d,e){e!==a&&(f=f.concat(this._findDifferentLinksForPath(b,
c,d)))}.bind(this));f.length&&this._addDifferentLinks(b,f,d)}};b.prototype._findDifferentLinksForPath=function(b,c,a){var d=[];b=this._getFolder(b,a);return d=b.isNew?c.links:this._findNewLinks(b.body,c)};b.prototype._getFolder=function(b,c){var a={body:c,isNew:!1};b.forEach(function(b){a.body[b]?a.body=a.body[b]:a.isNew=!0});return a};b.prototype._findNewLinks=function(b,c){var a=[];if(!b.links.length)return a;c.links.forEach(function(d){this._isNewLink(b,d.url)&&a.push(d)}.bind(this));return a};
b.prototype._isNewLink=function(b,c){var a=!0;b.links.forEach(function(b){b.url===c&&(a=!1)});return a};b.prototype._addDifferentFolder=function(b,c){var a=this._differentBookmarks;b.forEach(function(b){a[b]=a[b]||{links:[],data:{}};a=a[b]});a.data=c};b.prototype._addDifferentLinks=function(b,c,a){var d=this._differentBookmarks,f=a;b.forEach(function(a){d[a]=d[a]||{links:[],data:this._cloneData(f[a].data)};d=d[a];f=f[a]}.bind(this));d.links=c};b.prototype._cloneData=function(b){var c={},a;for(a in b)c[a]=
b[a];return c};e.exports=b},{}],4:[function(l,e,g){function b(){this.CONST={TAB_SIZE:4};this._string=[]}b.prototype.parse=function(b,c){this._string=[];this._jsonToString("",b,0);return c?this._string:this._getString()};b.prototype._jsonToString=function(b,c,a){var d=this._calcOffset(a),f=d+this._calcOffset(1);b&&(this._addTitleFromJson(b,d,c.data),a++);this._addLinksFromJson(f,c.links);this._addNextLevelFromJson(c,a);this._closeTitleFromJson(b,d)};b.prototype._calcOffset=function(b){return Array(b*
this.CONST.TAB_SIZE+1).join(" ")};b.prototype._addTitleFromJson=function(b,c,a){var d="Bookmarks"===b;this._string.push(c+(d?"<H1>":"<DT><H3"+(a.added?' ADD_DATE="'+a.added+'"':"")+(a.modify?' LAST_MODIFIED="'+a.modify+'"':"")+(a.personal?' PERSONAL_TOOLBAR_FOLDER="'+a.personal+'"':"")+">")+b+(d?"</H1>":"/<H3>"));this._string.push(c+"<DL><p>")};b.prototype._addLinksFromJson=function(b,c){c&&c.forEach(function(a){this._string.push(b+'<DT><A HREF="'+a.url+'" ADD_DATE="'+a.added+'" ICON="'+a.icon+'">'+
a.title+"</A>")}.bind(this))};b.prototype._addNextLevelFromJson=function(b,c){if(b&&!(0>this._a))for(var a in b)"links"!==a&&"data"!==a&&this._string.push(this._jsonToString(a,b[a],c))};b.prototype._closeTitleFromJson=function(b,c){b&&this._string.push(c+"</DL><p>")};b.prototype._getString=function(){return this._string.join("\n")};e.exports=b},{}],5:[function(l,e,g){function b(){this.DEFAULTS={ID:"bookmarksFiles"};this._options={id:"",container:""};this._downloadLink=this._input=null;this._files=
[];this._bookmarks=[];this._newFile={head:[],body:[]};this._fileBody={};this._folderLevel={};this._breadcrumbs=[]}g=l("./compare");l=l("./json_to_string");var k=new g,c=new l;b.prototype.init=function(a){this._setOptions(a||{});this._attachInput()};b.prototype._setOptions=function(a){this._options={id:a.id||"",container:a.container||""}};b.prototype._attachInput=function(){this._input=this._findInput();this._input||(this._input=this._createInput());this._input.addEventListener("change",this._onInputChange.bind(this),
!1)};b.prototype._findInput=function(){var a=null;this._options.id&&(a=document.getElementById(this._options.id));!a||"input"===a.tagName.toLowerCase()&&"file"===a.type||(a=null);return a};b.prototype._createInput=function(){var a=document.createElement("input");a.id=this._options.id||this.DEFAULTS.ID;a.type="file";a.setAttribute("multiple","");document.body.appendChild(a);return a};b.prototype._onInputChange=function(){var a;this._hideDownloadLink();this._bookmarks=[];this._files=this._input.files;
this._newFile.head=[];this._newFile.body=[];for(var b=0,c=this._files.length;b<c;b++)a=new FileReader,a.addEventListener("load",this._readFile.bind(this),!1),a.readAsText(this._files[b])};b.prototype._readFile=function(a){a=a.target.result.split("\n");var b=this._parseLine.bind(this);this._breadcrumbs=[];this._folderLevel=this._fileBody={};a.forEach(b);this._bookmarks.push(this._fileBody);this._compareAfterFinish()};b.prototype._parseLine=function(a){a=a.trim();0===a.indexOf("<DT><H3")||0===a.indexOf("<H1")?
this._addTitle(a):0===a.indexOf("<DL>")?this._addFolder(a):0===a.indexOf("<DT><A")?this._addLink(a):0===a.indexOf("</DL>")?this._closeFolder():this._addToHead(a)};b.prototype._addToHead=function(a){1===this._bookmarks.length&&this._newFile.head.push(a)};b.prototype._addTitle=function(a){var b=a.match(/>([^<^>]+)<\//),c=a.match(/ADD_DATE="([^"]*)"/),e=a.match(/LAST_MODIFIED="([^"]*)"/);a=a.match(/PERSONAL_TOOLBAR_FOLDER="([^"]*)"/);this._breadcrumbs.push({title:b?b[1]:"",added:c?c[1]:"",modify:e?e[1]:
"",personal:a?a[1]:""})};b.prototype._addFolder=function(a){this._folderLevel=this._fileBody;this._breadcrumbs.forEach(function(a){this._folderLevel[a.title]=this._folderLevel[a.title]||{links:[],data:{added:a.added,modify:a.modify,personal:a.personal}};this._folderLevel=this._folderLevel[a.title]}.bind(this))};b.prototype._addLink=function(a){var b=a.match(/>([^<^>]+)<\//),c=a.match(/HREF="([^"]*)"/),e=a.match(/ADD_DATE="([^"]*)"/);a=a.match(/ICON="([^"]*)"/);this._folderLevel.links.push({title:b?
b[1]:"",url:c?c[1]:"",added:e?e[1]:"",icon:a?a[1]:""})};b.prototype._closeFolder=function(){this._breadcrumbs.pop()};b.prototype._compareAfterFinish=function(){if(this._bookmarks.length===this._files.length){var a=k.compare(this._bookmarks);this._newFile.body=c.parse(a,!0);this._newFile.body?this._downloadFile():alert("Not found different bookmarks");this._input.value=""}};b.prototype._arrayToString=function(a){return a.join("\n")};b.prototype._downloadFile=function(){this._updateInput();this._showDownloadLink()};
b.prototype._updateInput=function(){this._createDownloadLink();this._textToUrl()};b.prototype._textToUrl=function(){var a=new Blob([this._arrayToString(this._newFile.head)+this._arrayToString(this._newFile.body)]),a=URL.createObjectURL(a);this._downloadLink.href=a};b.prototype._createDownloadLink=function(){this._downloadLink||(this._downloadLink=document.createElement("a"),this._downloadLink.textContent="download",this._downloadLink.download="new_bookmarks.html",document.body.appendChild(this._downloadLink))};
b.prototype._showDownloadLink=function(){this._downloadLink&&this._downloadLink.classList.remove("hidden")};b.prototype._hideDownloadLink=function(){this._downloadLink&&this._downloadLink.classList.add("hidden")};e.exports=b},{"./compare":3,"./json_to_string":4}]},{},[2]);
